<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title> - transit.coffee</title>

  <link rel="stylesheet" href="../assets/style.css">
  
    
      <style>
        
      </style>
    
  

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
  <meta name="groc-relative-root" content="../"/>
  <meta name="groc-document-path" content="js/transit.coffee"/>
  
</head>
<body>
  <div id="file-area">
    <div id="meta">
      <code class="file-path">
      
        <a href="https://github.com/legomushroom/mojs.git/blob/master/js/transit.coffee">js/transit.coffee</a>
      
      </code>
    </div>
    <div id="document">
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>istanbul ignore next</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">h         = <span class="hljs-built_in">require</span> <span class="hljs-string">'./h'</span>
bitsMap   = <span class="hljs-built_in">require</span> <span class="hljs-string">'./shapes/bitsMap'</span>
Timeline = <span class="hljs-built_in">require</span> <span class="hljs-string">'./tween/timeline'</span>
Tween    = <span class="hljs-built_in">require</span> <span class="hljs-string">'./tween/tween'</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Transit</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">bitsMap</span>.<span class="hljs-title">map</span>.<span class="hljs-title">bit</span></span>
  <span class="hljs-attribute">progress</span>: <span class="hljs-number">0</span>
  <span class="hljs-attribute">defaults</span>:</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>presentation props</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-attribute">strokeWidth</span>:        <span class="hljs-number">2</span>
    <span class="hljs-attribute">strokeOpacity</span>:      <span class="hljs-number">1</span>
    <span class="hljs-attribute">strokeDasharray</span>:    <span class="hljs-number">0</span>
    <span class="hljs-attribute">strokeDashoffset</span>:   <span class="hljs-number">0</span>
    <span class="hljs-attribute">stroke</span>:             <span class="hljs-string">'transparent'</span>
    <span class="hljs-attribute">fill</span>:               <span class="hljs-string">'deeppink'</span>
    <span class="hljs-attribute">fillOpacity</span>:        <span class="hljs-string">'transparent'</span>
    <span class="hljs-attribute">strokeLinecap</span>:      <span class="hljs-string">''</span>
    <span class="hljs-attribute">points</span>:             <span class="hljs-number">3</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>position props/el props</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-attribute">x</span>:                  <span class="hljs-number">0</span>
    <span class="hljs-attribute">y</span>:                  <span class="hljs-number">0</span>
    <span class="hljs-attribute">shiftX</span>:             <span class="hljs-number">0</span>
    <span class="hljs-attribute">shiftY</span>:             <span class="hljs-number">0</span>
    <span class="hljs-attribute">opacity</span>:            <span class="hljs-number">1</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>size props</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-attribute">radius</span>:             <span class="hljs-number">0</span>: <span class="hljs-number">50</span>
    <span class="hljs-attribute">radiusX</span>:            <span class="hljs-literal">undefined</span>
    <span class="hljs-attribute">radiusY</span>:            <span class="hljs-literal">undefined</span>
    <span class="hljs-attribute">angle</span>:              <span class="hljs-number">0</span>
    <span class="hljs-attribute">size</span>:               <span class="hljs-literal">null</span>
    <span class="hljs-attribute">sizeGap</span>:            <span class="hljs-number">0</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>callbacks</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-attribute">onStart</span>:            <span class="hljs-literal">null</span>
    <span class="hljs-attribute">onComplete</span>:         <span class="hljs-literal">null</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>onCompleteChain:    null</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-attribute">onUpdate</span>:           <span class="hljs-literal">null</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>tween props</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-attribute">duration</span>:           <span class="hljs-number">500</span>
    <span class="hljs-attribute">delay</span>:              <span class="hljs-number">0</span>
    <span class="hljs-attribute">repeat</span>:             <span class="hljs-number">0</span>
    <span class="hljs-attribute">yoyo</span>:               <span class="hljs-literal">false</span>
    <span class="hljs-attribute">easing</span>:             <span class="hljs-string">'Linear.None'</span>
  <span class="hljs-attribute">vars</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@h</span> ?= h; <span class="hljs-property">@lastSet</span> ?= {}; <span class="hljs-property">@index</span> = <span class="hljs-property">@o</span>.index <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>
    <span class="hljs-property">@runCount</span> ?= <span class="hljs-number">0</span>
    <span class="hljs-property">@extendDefaults</span>()
    o = <span class="hljs-property">@h</span>.cloneObj(<span class="hljs-property">@o</span>); <span class="hljs-property">@h</span>.extend(o, <span class="hljs-property">@defaults</span>)</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>inherit the radiusX/Y from radius if werent defined
o.radiusX ?= o.radius; o.radiusY ?= o.radius</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-property">@history</span> = [o]
    <span class="hljs-property">@isForeign</span> = !!<span class="hljs-property">@o</span>.ctx; <span class="hljs-property">@isForeignBit</span> = !!<span class="hljs-property">@o</span>.bit
    <span class="hljs-property">@timelines</span> = []

  <span class="hljs-attribute">render</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">if</span> !<span class="hljs-property">@isRendered</span><span class="hljs-comment"># or isForce</span>
      <span class="hljs-keyword">if</span> !<span class="hljs-property">@isForeign</span> <span class="hljs-keyword">and</span> !<span class="hljs-property">@isForeignBit</span>
        <span class="hljs-property">@ctx</span> = <span class="hljs-built_in">document</span>.createElementNS <span class="hljs-property">@ns</span>, <span class="hljs-string">'svg'</span>
        <span class="hljs-property">@ctx</span>.style.position  = <span class="hljs-string">'absolute'</span>
        <span class="hljs-property">@ctx</span>.style.width     = <span class="hljs-string">'100%'</span>
        <span class="hljs-property">@ctx</span>.style.height    = <span class="hljs-string">'100%'</span>
        <span class="hljs-property">@createBit</span>(); <span class="hljs-property">@calcSize</span>()
        <span class="hljs-property">@el</span> = <span class="hljs-built_in">document</span>.createElement <span class="hljs-string">'div'</span>
        <span class="hljs-property">@el</span>.appendChild <span class="hljs-property">@ctx</span>
        (<span class="hljs-property">@o</span>.parent <span class="hljs-keyword">or</span> <span class="hljs-built_in">document</span>.body).appendChild <span class="hljs-property">@el</span>
      <span class="hljs-keyword">else</span>
        <span class="hljs-property">@ctx</span> = <span class="hljs-property">@o</span>.ctx; <span class="hljs-property">@createBit</span>(); <span class="hljs-property">@calcSize</span>()
      <span class="hljs-property">@isRendered</span> = <span class="hljs-literal">true</span>
    <span class="hljs-property">@setElStyles</span>()
    <span class="hljs-property">@setProgress</span> <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>
    <span class="hljs-property">@createTween</span>()
    @

  <span class="hljs-attribute">setElStyles</span>:<span class="hljs-function">-&gt;</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>size        = &quot;#{@props.size/@h.remBase}rem&quot;</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> !<span class="hljs-property">@isForeign</span>
      size        = <span class="hljs-string">"<span class="hljs-subst">#{<span class="hljs-property">@props</span>.size}</span>px"</span>
      marginSize  = <span class="hljs-string">"<span class="hljs-subst">#{-<span class="hljs-property">@props</span>.size/<span class="hljs-number">2</span>}</span>px"</span>
      <span class="hljs-property">@el</span>.style.position    = <span class="hljs-string">'absolute'</span>
      <span class="hljs-property">@el</span>.style.top         = <span class="hljs-property">@props</span>.y
      <span class="hljs-property">@el</span>.style.left        = <span class="hljs-property">@props</span>.x
      <span class="hljs-property">@el</span>.style.width       = size
      <span class="hljs-property">@el</span>.style.height      = size
      <span class="hljs-property">@el</span>.style[<span class="hljs-string">'margin-left'</span>] = marginSize
      <span class="hljs-property">@el</span>.style[<span class="hljs-string">'margin-top'</span>]  = marginSize
      <span class="hljs-property">@el</span>.style[<span class="hljs-string">'marginLeft'</span>]  = marginSize
      <span class="hljs-property">@el</span>.style[<span class="hljs-string">'marginTop'</span>]   = marginSize</div></div>
      
      </div>
    
      <div class="segment">
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-property">@el</span>?.style.opacity     = <span class="hljs-property">@props</span>.opacity
    <span class="hljs-keyword">if</span> <span class="hljs-property">@o</span>.isShowInit <span class="hljs-keyword">then</span> <span class="hljs-property">@show</span>() <span class="hljs-keyword">else</span> <span class="hljs-property">@hide</span>()

  <span class="hljs-attribute">show</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@isShown</span> <span class="hljs-keyword">or</span> !<span class="hljs-property">@el</span>?
    <span class="hljs-property">@el</span>.style.display = <span class="hljs-string">'block'</span>
    <span class="hljs-property">@isShown</span> = <span class="hljs-literal">true</span>
  <span class="hljs-attribute">hide</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> (<span class="hljs-property">@isShown</span> <span class="hljs-keyword">is</span> <span class="hljs-literal">false</span>) <span class="hljs-keyword">or</span> !<span class="hljs-property">@el</span>?
    <span class="hljs-property">@el</span>.style.display = <span class="hljs-string">'none'</span>
    <span class="hljs-property">@isShown</span> = <span class="hljs-literal">false</span>

  <span class="hljs-attribute">draw</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@bit</span>.setProp
      <span class="hljs-attribute">x</span>:                  <span class="hljs-property">@origin</span>.x
      <span class="hljs-attribute">y</span>:                  <span class="hljs-property">@origin</span>.y
      <span class="hljs-attribute">stroke</span>:             <span class="hljs-property">@props</span>.stroke
      <span class="hljs-string">'stroke-width'</span>:     <span class="hljs-property">@props</span>.strokeWidth
      <span class="hljs-string">'stroke-opacity'</span>:   <span class="hljs-property">@props</span>.strokeOpacity
      <span class="hljs-string">'stroke-dasharray'</span>: <span class="hljs-property">@props</span>.strokeDasharray
      <span class="hljs-string">'stroke-dashoffset'</span>:<span class="hljs-property">@props</span>.strokeDashoffset
      <span class="hljs-string">'stroke-linecap'</span>:   <span class="hljs-property">@props</span>.strokeLinecap
      <span class="hljs-attribute">fill</span>:               <span class="hljs-property">@props</span>.fill
      <span class="hljs-string">'fill-opacity'</span>:     <span class="hljs-property">@props</span>.fillOpacity
      <span class="hljs-attribute">radius</span>:             <span class="hljs-property">@props</span>.radius
      <span class="hljs-attribute">radiusX</span>:            <span class="hljs-property">@props</span>.radiusX
      <span class="hljs-attribute">radiusY</span>:            <span class="hljs-property">@props</span>.radiusY
      <span class="hljs-attribute">points</span>:             <span class="hljs-property">@props</span>.points
      <span class="hljs-attribute">transform</span>:          <span class="hljs-property">@calcTransform</span>()

    <span class="hljs-property">@bit</span>.draw()
    <span class="hljs-property">@drawEl</span>()

  <span class="hljs-attribute">drawEl</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> !<span class="hljs-property">@el</span>?
    <span class="hljs-property">@isPropChanged</span>(<span class="hljs-string">'opacity'</span>) <span class="hljs-keyword">and</span> (<span class="hljs-property">@el</span>.style.opacity = <span class="hljs-property">@props</span>.opacity)
    <span class="hljs-keyword">if</span> !<span class="hljs-property">@isForeign</span>
      <span class="hljs-property">@isPropChanged</span>(<span class="hljs-string">'x'</span>) <span class="hljs-keyword">and</span> (<span class="hljs-property">@el</span>.style.left = <span class="hljs-property">@props</span>.x)
      <span class="hljs-property">@isPropChanged</span>(<span class="hljs-string">'y'</span>) <span class="hljs-keyword">and</span> (<span class="hljs-property">@el</span>.style.top  = <span class="hljs-property">@props</span>.y)
      <span class="hljs-keyword">if</span> <span class="hljs-property">@isNeedsTransform</span>()
        <span class="hljs-property">@h</span>.setPrefixedStyle <span class="hljs-property">@el</span>, <span class="hljs-string">'transform'</span>, <span class="hljs-property">@fillTransform</span>()

  <span class="hljs-attribute">fillTransform</span>:<span class="hljs-function">-&gt;</span> <span class="hljs-string">"translate(<span class="hljs-subst">#{<span class="hljs-property">@props</span>.shiftX}</span>, <span class="hljs-subst">#{<span class="hljs-property">@props</span>.shiftY}</span>)"</span>
  <span class="hljs-attribute">isNeedsTransform</span>:<span class="hljs-function">-&gt;</span>
    isX = <span class="hljs-property">@isPropChanged</span>(<span class="hljs-string">'shiftX'</span>); isY = <span class="hljs-property">@isPropChanged</span>(<span class="hljs-string">'shiftY'</span>); isX <span class="hljs-keyword">or</span> isY
  <span class="hljs-attribute">isPropChanged</span>:<span class="hljs-function"><span class="hljs-params">(name)</span>-&gt;</span>
    <span class="hljs-property">@lastSet</span>[name] ?= {}
    <span class="hljs-keyword">if</span> <span class="hljs-property">@lastSet</span>[name].value <span class="hljs-keyword">isnt</span> <span class="hljs-property">@props</span>[name]
      <span class="hljs-property">@lastSet</span>[name].value = <span class="hljs-property">@props</span>[name]; <span class="hljs-literal">true</span>
    <span class="hljs-keyword">else</span> <span class="hljs-literal">false</span>

  <span class="hljs-attribute">calcTransform</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@props</span>.transform = <span class="hljs-string">"rotate(<span class="hljs-subst">#{<span class="hljs-property">@props</span>.angle}</span>,<span class="hljs-subst">#{<span class="hljs-property">@origin</span>.x}</span>,<span class="hljs-subst">#{<span class="hljs-property">@origin</span>.y}</span>)"</span>
    
  <span class="hljs-attribute">calcSize</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@o</span>.size
    radius = <span class="hljs-property">@calcMaxRadius</span>()

    dStroke = <span class="hljs-property">@deltas</span>[<span class="hljs-string">'strokeWidth'</span>]
    stroke = <span class="hljs-keyword">if</span> dStroke?
      Math.max Math.abs(dStroke.start), Math.abs(dStroke.end)
    <span class="hljs-keyword">else</span> <span class="hljs-property">@props</span>.strokeWidth
    <span class="hljs-property">@props</span>.size = <span class="hljs-number">2</span>*radius + <span class="hljs-number">2</span>*stroke
    </div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>increase el&#39;s size on elastic
and back easings</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">switch</span> <span class="hljs-property">@props</span>.easing.toLowerCase?()
      <span class="hljs-keyword">when</span> <span class="hljs-string">'elastic.out'</span>, <span class="hljs-string">'elastic.inout'</span>
        <span class="hljs-property">@props</span>.size *= <span class="hljs-number">1.25</span>
      <span class="hljs-keyword">when</span> <span class="hljs-string">'back.out'</span>, <span class="hljs-string">'back.inout'</span>
        <span class="hljs-property">@props</span>.size *= <span class="hljs-number">1.1</span>

    <span class="hljs-property">@props</span>.size   *= <span class="hljs-property">@bit</span>.ratio
    <span class="hljs-property">@props</span>.size   += <span class="hljs-number">2</span>*<span class="hljs-property">@props</span>.sizeGap
    <span class="hljs-property">@props</span>.center = <span class="hljs-property">@props</span>.size/<span class="hljs-number">2</span>

  <span class="hljs-attribute">calcMaxRadius</span>:<span class="hljs-function">-&gt;</span>
    selfSize  = <span class="hljs-property">@getRadiusSize</span> <span class="hljs-attribute">key</span>: <span class="hljs-string">'radius'</span>
    selfSizeX = <span class="hljs-property">@getRadiusSize</span> <span class="hljs-attribute">key</span>: <span class="hljs-string">'radiusX'</span>, <span class="hljs-attribute">fallback</span>: selfSize
    selfSizeY = <span class="hljs-property">@getRadiusSize</span> <span class="hljs-attribute">key</span>: <span class="hljs-string">'radiusY'</span>, <span class="hljs-attribute">fallback</span>: selfSize
    Math.max selfSizeX, selfSizeY

  <span class="hljs-attribute">getRadiusSize</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@deltas</span>[o.key]?
      Math.max Math.abs(<span class="hljs-property">@deltas</span>[o.key].end), Math.abs(<span class="hljs-property">@deltas</span>[o.key].start)
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@props</span>[o.key]? <span class="hljs-keyword">then</span> parseFloat(<span class="hljs-property">@props</span>[o.key]) <span class="hljs-keyword">else</span> o.fallback <span class="hljs-keyword">or</span> <span class="hljs-number">0</span>

  <span class="hljs-attribute">createBit</span>:<span class="hljs-function">-&gt;</span>
    bitClass = bitsMap.getBit(<span class="hljs-property">@o</span>.type <span class="hljs-keyword">or</span> <span class="hljs-property">@type</span>)
    <span class="hljs-property">@bit</span> = <span class="hljs-keyword">new</span> bitClass <span class="hljs-attribute">ctx</span>: <span class="hljs-property">@ctx</span>, <span class="hljs-attribute">el</span>: <span class="hljs-property">@o</span>.bit, <span class="hljs-attribute">isDrawLess</span>: <span class="hljs-literal">true</span>
    <span class="hljs-keyword">if</span> <span class="hljs-property">@isForeign</span> <span class="hljs-keyword">or</span> <span class="hljs-property">@isForeignBit</span> <span class="hljs-keyword">then</span> <span class="hljs-property">@el</span> = <span class="hljs-property">@bit</span>.el

  <span class="hljs-attribute">setProgress</span>:<span class="hljs-function"><span class="hljs-params">(progress, isShow)</span>-&gt;</span>
    <span class="hljs-keyword">if</span> !isShow <span class="hljs-keyword">then</span> <span class="hljs-property">@show</span>(); <span class="hljs-property">@onUpdate</span>?(progress)
    <span class="hljs-property">@progress</span> = <span class="hljs-keyword">if</span> progress &lt; <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> !progress <span class="hljs-keyword">then</span> <span class="hljs-number">0</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> progress &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">then</span> <span class="hljs-number">1</span> <span class="hljs-keyword">else</span> progress</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>calc the curent value from deltas</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-property">@calcCurrentProps</span>(progress); <span class="hljs-property">@calcOrigin</span>()
    <span class="hljs-property">@draw</span>(progress)
    @

  <span class="hljs-attribute">calcCurrentProps</span>:<span class="hljs-function"><span class="hljs-params">(progress)</span>-&gt;</span>
    keys = Object.keys(<span class="hljs-property">@deltas</span>); len = keys.length
    <span class="hljs-keyword">while</span>(len--)
      key = keys[len]; value = <span class="hljs-property">@deltas</span>[key]
      <span class="hljs-property">@props</span>[key] = <span class="hljs-keyword">switch</span> value.type
        <span class="hljs-keyword">when</span> <span class="hljs-string">'array'</span> <span class="hljs-comment"># strokeDasharray/strokeDashoffset</span>
          stroke = []
          <span class="hljs-keyword">for</span> item, i <span class="hljs-keyword">in</span> value.delta
            dash = value.start[i].value + item.value*<span class="hljs-property">@progress</span>
            stroke.push { <span class="hljs-attribute">value</span>: dash, <span class="hljs-attribute">unit</span>: item.unit }
          stroke
        <span class="hljs-keyword">when</span> <span class="hljs-string">'number'</span>
          value.start + value.delta*progress
        <span class="hljs-keyword">when</span> <span class="hljs-string">'unit'</span>
          units = value.end.unit
          <span class="hljs-string">"<span class="hljs-subst">#{value.start.value+value.delta*progress}</span><span class="hljs-subst">#{units}</span>"</span>
        <span class="hljs-keyword">when</span> <span class="hljs-string">'color'</span>
          r = parseInt (value.start.r + value.delta.r*progress), <span class="hljs-number">10</span>
          g = parseInt (value.start.g + value.delta.g*progress), <span class="hljs-number">10</span>
          b = parseInt (value.start.b + value.delta.b*progress), <span class="hljs-number">10</span>
          a = parseInt (value.start.a + value.delta.a*progress), <span class="hljs-number">10</span>
          <span class="hljs-string">"rgba(<span class="hljs-subst">#{r}</span>,<span class="hljs-subst">#{g}</span>,<span class="hljs-subst">#{b}</span>,<span class="hljs-subst">#{a}</span>)"</span>

  <span class="hljs-attribute">calcOrigin</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@origin</span> = <span class="hljs-keyword">if</span> <span class="hljs-property">@o</span>.ctx <span class="hljs-keyword">then</span> <span class="hljs-attribute">x</span>: parseFloat(<span class="hljs-property">@props</span>.x), <span class="hljs-attribute">y</span>: parseFloat(<span class="hljs-property">@props</span>.y)
    <span class="hljs-keyword">else</span> <span class="hljs-attribute">x</span>: <span class="hljs-property">@props</span>.center, <span class="hljs-attribute">y</span>: <span class="hljs-property">@props</span>.center

  <span class="hljs-attribute">extendDefaults</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    <span class="hljs-property">@props</span> ?= {}; fromObject = o <span class="hljs-keyword">or</span> <span class="hljs-property">@defaults</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>override deltas only if options obj wasnt passed</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    !o? <span class="hljs-keyword">and</span> (<span class="hljs-property">@deltas</span> = {})

    keys = Object.keys(fromObject); len = keys.length
    <span class="hljs-keyword">while</span>(len--)
      key = keys[len]; defaultsValue = fromObject[key]</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>skip props from skipProps object</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">continue</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@skipProps</span>?[key]</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if options object was passed = save the value to
options object and delete the old delta value
is used for new run options</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> o
        <span class="hljs-property">@o</span>[key] = defaultsValue; optionsValue = defaultsValue</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>delete the old delta</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">delete</span> <span class="hljs-property">@deltas</span>[key]</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>else get the value from options or fallback to defaults</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">else</span> optionsValue = <span class="hljs-keyword">if</span> <span class="hljs-property">@o</span>[key]? <span class="hljs-keyword">then</span> <span class="hljs-property">@o</span>[key] <span class="hljs-keyword">else</span> defaultsValue</div></div>
      
      </div>
    
      <div class="segment">
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> !<span class="hljs-property">@isDelta</span>(optionsValue)</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>parse random values</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> optionsValue <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
          <span class="hljs-keyword">if</span> optionsValue.match <span class="hljs-regexp">/stagger/</span>
            optionsValue = <span class="hljs-property">@h</span>.parseStagger optionsValue, <span class="hljs-property">@index</span>
        <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> optionsValue <span class="hljs-keyword">is</span> <span class="hljs-string">'string'</span>
          <span class="hljs-keyword">if</span> optionsValue.match <span class="hljs-regexp">/rand/</span>
            optionsValue = <span class="hljs-property">@h</span>.parseRand optionsValue</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>save to props</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-property">@props</span>[key] = optionsValue
        <span class="hljs-keyword">if</span> key <span class="hljs-keyword">is</span> <span class="hljs-string">'radius'</span>
          <span class="hljs-keyword">if</span> !<span class="hljs-property">@o</span>.radiusX? <span class="hljs-keyword">then</span> <span class="hljs-property">@props</span>.radiusX = optionsValue
          <span class="hljs-keyword">if</span> !<span class="hljs-property">@o</span>.radiusY? <span class="hljs-keyword">then</span> <span class="hljs-property">@props</span>.radiusY = optionsValue</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>position properties should be parsed with units</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> <span class="hljs-property">@h</span>.posPropsMap[key]
          <span class="hljs-property">@props</span>[key] = <span class="hljs-property">@h</span>.parseUnit(<span class="hljs-property">@props</span>[key]).string</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>strokeDash properties should be parsed with units</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> <span class="hljs-property">@h</span>.strokeDashPropsMap[key]
          property = <span class="hljs-property">@props</span>[key]; value = []
          <span class="hljs-keyword">switch</span> <span class="hljs-keyword">typeof</span> property
            <span class="hljs-keyword">when</span> <span class="hljs-string">'number'</span>
              value.push <span class="hljs-property">@h</span>.parseUnit(property)
            <span class="hljs-keyword">when</span> <span class="hljs-string">'string'</span>
              array = <span class="hljs-property">@props</span>[key].split <span class="hljs-string">' '</span>
              <span class="hljs-keyword">for</span> unit, i <span class="hljs-keyword">in</span> array
                value.push <span class="hljs-property">@h</span>.parseUnit(unit)
          <span class="hljs-property">@props</span>[key] = value
        <span class="hljs-keyword">continue</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if delta object was passed: like { 20: 75 }
calculate delta</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-property">@isSkipDelta</span> <span class="hljs-keyword">or</span> <span class="hljs-property">@getDelta</span> key, optionsValue
    <span class="hljs-property">@onUpdate</span> = <span class="hljs-property">@props</span>.onUpdate

  <span class="hljs-attribute">isDelta</span>:<span class="hljs-function"><span class="hljs-params">(optionsValue)</span>-&gt;</span>
    isObject = (optionsValue? <span class="hljs-keyword">and</span> (<span class="hljs-keyword">typeof</span> optionsValue <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span>))
    isObject = isObject <span class="hljs-keyword">and</span> !optionsValue.unit
    <span class="hljs-keyword">not</span> (!isObject <span class="hljs-keyword">or</span> <span class="hljs-property">@h</span>.isArray(optionsValue) <span class="hljs-keyword">or</span> h.isDOM(optionsValue))

  <span class="hljs-attribute">getDelta</span>:<span class="hljs-function"><span class="hljs-params">(key, optionsValue)</span>-&gt;</span>
    <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> <span class="hljs-string">'x'</span> <span class="hljs-keyword">or</span> key <span class="hljs-keyword">is</span> <span class="hljs-string">'y'</span>) <span class="hljs-keyword">and</span> !<span class="hljs-property">@o</span>.ctx
      <span class="hljs-property">@h</span>.warn <span class="hljs-string">'Consider to animate shiftX/shiftY properties instead of x/y,
       as it would be much more performant'</span>, optionsValue</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>skip props defined in skipPropsDelta map
needed for modules based on transit like swirl</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-property">@skipPropsDelta</span>?[key]
    delta = <span class="hljs-property">@h</span>.parseDelta key, optionsValue, <span class="hljs-property">@defaults</span>[key]</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>stoke-linecap filter</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> delta.type? <span class="hljs-keyword">then</span> <span class="hljs-property">@deltas</span>[key] = delta</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>and set the start value to props</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-property">@props</span>[key] = delta.start

  <span class="hljs-attribute">mergeThenOptions</span>:<span class="hljs-function"><span class="hljs-params">(start, end)</span>-&gt;</span>
    o = {}</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>copy start values to o to exclude tween options and callbacks
but inherit duration</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> start
      <span class="hljs-keyword">if</span> !<span class="hljs-property">@h</span>.tweenOptionMap[key] <span class="hljs-keyword">and</span> !<span class="hljs-property">@h</span>.callbacksMap[key] <span class="hljs-keyword">or</span> key <span class="hljs-keyword">is</span> <span class="hljs-string">'duration'</span>
        o[key] = value
      <span class="hljs-keyword">else</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if tween option or callback reset it</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        o[key] = <span class="hljs-keyword">if</span> key <span class="hljs-keyword">is</span> <span class="hljs-string">'easing'</span> <span class="hljs-keyword">then</span> <span class="hljs-string">''</span> <span class="hljs-keyword">else</span> <span class="hljs-literal">undefined</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>loop thru result object</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    keys = Object.keys(end); i = keys.length
    <span class="hljs-keyword">while</span>(i--)
      key = keys[i]; endValue = end[key]
      </div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if new value is a tween value or new value is an object/ function
then just save it</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      isFunction = <span class="hljs-keyword">typeof</span> endValue <span class="hljs-keyword">is</span> <span class="hljs-string">'function'</span>
      <span class="hljs-keyword">if</span> <span class="hljs-property">@h</span>.tweenOptionMap[key] <span class="hljs-keyword">or</span> <span class="hljs-keyword">typeof</span> endValue <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span> <span class="hljs-keyword">or</span> isFunction
        o[key] = <span class="hljs-keyword">if</span> endValue? <span class="hljs-keyword">then</span> endValue <span class="hljs-keyword">else</span> start[key]
        <span class="hljs-keyword">continue</span>

      startKey = start[key]; startKey ?= <span class="hljs-property">@defaults</span>[key]</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>inherit radius value for radiusX/Y</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> (key <span class="hljs-keyword">is</span> <span class="hljs-string">'radiusX'</span> <span class="hljs-keyword">or</span> key <span class="hljs-keyword">is</span> <span class="hljs-string">'radiusY'</span>) <span class="hljs-keyword">and</span> !startKey?
        startKey = start.radius</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if start value is object - rewrite the start value</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> startKey <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span> <span class="hljs-keyword">and</span> startKey?</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>set startKey to delta object&#39;s start valeu</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        startKeys = Object.keys(startKey); startKey = startKey[startKeys[<span class="hljs-number">0</span>]]

      <span class="hljs-keyword">if</span> endValue?</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>make delta object</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        o[key] = {}; o[key][startKey] = endValue</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if endValue is null or undefined save start value to options
else o[key] = startKey</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    o

  <span class="hljs-attribute">then</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> !o? <span class="hljs-keyword">or</span> !Object.keys(o)
    merged = <span class="hljs-property">@mergeThenOptions</span> <span class="hljs-property">@history</span>[<span class="hljs-property">@history</span>.length-<span class="hljs-number">1</span>], o
    <span class="hljs-property">@history</span>.push merged</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>copy the tween options from passed o or current props</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    keys = Object.keys(<span class="hljs-property">@h</span>.tweenOptionMap); i = keys.length; opts = {}
    opts[keys[i]] = merged[keys[i]] <span class="hljs-keyword">while</span>(i--)
    it = @; len = it.history.length
    <span class="hljs-keyword">do</span> (len)=&gt;
      opts.onUpdate      = <span class="hljs-function"><span class="hljs-params">(p)</span>=&gt;</span> <span class="hljs-property">@setProgress</span> p
      opts.onStart       = <span class="hljs-function">=&gt;</span> <span class="hljs-property">@props</span>.onStart?.apply(@)
      opts.onComplete    = <span class="hljs-function">=&gt;</span> <span class="hljs-property">@props</span>.onComplete?.apply @
      opts.onFirstUpdate = <span class="hljs-function">-&gt;</span> it.tuneOptions it.history[<span class="hljs-property">@index</span>]
      opts.isChained = !o.delay
      <span class="hljs-property">@tween</span>.append <span class="hljs-keyword">new</span> Timeline(opts)
    @
    
  <span class="hljs-attribute">tuneOptions</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span> <span class="hljs-property">@extendDefaults</span>(o); <span class="hljs-property">@calcSize</span>(); <span class="hljs-property">@setElStyles</span>()</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>TWEEN</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">  <span class="hljs-attribute">createTween</span>:<span class="hljs-function">-&gt;</span>
    it = @
    <span class="hljs-property">@createTimeline</span>()
    <span class="hljs-property">@tween</span> = <span class="hljs-keyword">new</span> Tween
      <span class="hljs-attribute">onComplete</span>:<span class="hljs-function">=&gt;</span> !<span class="hljs-property">@o</span>.isShowEnd <span class="hljs-keyword">and</span> <span class="hljs-property">@hide</span>(); <span class="hljs-property">@props</span>.onComplete?.apply @
    <span class="hljs-property">@tween</span>.add <span class="hljs-property">@timeline</span>
    !<span class="hljs-property">@o</span>.isRunLess <span class="hljs-keyword">and</span> <span class="hljs-property">@startTween</span>()

  <span class="hljs-attribute">createTimeline</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@timeline</span> = <span class="hljs-keyword">new</span> Timeline
      <span class="hljs-attribute">duration</span>: <span class="hljs-property">@props</span>.duration
      <span class="hljs-attribute">delay</span>:    <span class="hljs-property">@props</span>.delay
      <span class="hljs-attribute">repeat</span>:   <span class="hljs-property">@props</span>.repeat
      <span class="hljs-attribute">yoyo</span>:     <span class="hljs-property">@props</span>.yoyo
      <span class="hljs-attribute">easing</span>:   <span class="hljs-property">@props</span>.easing
      <span class="hljs-attribute">onUpdate</span>: <span class="hljs-function"><span class="hljs-params">(p)</span>=&gt;</span> <span class="hljs-property">@setProgress</span> p
      <span class="hljs-attribute">onStart</span>:<span class="hljs-function">=&gt;</span> <span class="hljs-property">@show</span>(); <span class="hljs-property">@props</span>.onStart?.apply @
      <span class="hljs-attribute">onFirstUpdateBackward</span>:<span class="hljs-function">=&gt;</span>
        <span class="hljs-property">@history</span>.length &gt; <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> <span class="hljs-property">@tuneOptions</span> <span class="hljs-property">@history</span>[<span class="hljs-number">0</span>]
      <span class="hljs-attribute">onReverseComplete</span>:<span class="hljs-function">=&gt;</span>
        !<span class="hljs-property">@o</span>.isShowInit <span class="hljs-keyword">and</span> <span class="hljs-property">@hide</span>(); <span class="hljs-property">@props</span>.onReverseComplete?.apply @

  <span class="hljs-attribute">run</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    <span class="hljs-property">@runCount</span>++
    <span class="hljs-keyword">if</span> o <span class="hljs-keyword">and</span> Object.keys(o).length</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if then chain is present and the user tries to
change the start timing - warn him and delete the
props to prevent the timing change</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">if</span> <span class="hljs-property">@history</span>.length &gt; <span class="hljs-number">1</span>
        keys = Object.keys(o); len = keys.length
        <span class="hljs-keyword">while</span>(len--)
          key = keys[len]
          <span class="hljs-keyword">if</span> h.callbacksMap[key] <span class="hljs-keyword">or</span> h.tweenOptionMap[key]
            h.warn <span class="hljs-string">"the property \"<span class="hljs-subst">#{key}</span>\" property can not
              be overridden on run with \"then\" chain yet"</span>
            <span class="hljs-keyword">delete</span> o[key]</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>transform the history, tune current option and save to
the history but only if actual options were passed</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-property">@transformHistory</span>(o)
      <span class="hljs-property">@tuneNewOption</span>(o)
      o = <span class="hljs-property">@h</span>.cloneObj(<span class="hljs-property">@o</span>); <span class="hljs-property">@h</span>.extend(o, <span class="hljs-property">@defaults</span>); <span class="hljs-property">@history</span>[<span class="hljs-number">0</span>] = o
      !<span class="hljs-property">@o</span>.isDrawLess <span class="hljs-keyword">and</span> <span class="hljs-property">@setProgress</span>(<span class="hljs-number">0</span>, <span class="hljs-literal">true</span>)
    <span class="hljs-keyword">else</span> <span class="hljs-property">@tuneNewOption</span> <span class="hljs-property">@history</span>[<span class="hljs-number">0</span>]
    <span class="hljs-property">@startTween</span>()
</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>adds new options to history chain
on run call</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">  <span class="hljs-attribute">transformHistory</span>:<span class="hljs-function"><span class="hljs-params">(o)</span>-&gt;</span>
    keys = Object.keys(o); i = -<span class="hljs-number">1</span>
    len = keys.length; historyLen = <span class="hljs-property">@history</span>.length</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>loop over the past options</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">while</span>(++i &lt; len)
      key = keys[i]; j = <span class="hljs-number">0</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>loop over the history skipping the first item</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">      <span class="hljs-keyword">while</span>(++j &lt; historyLen)
        optionRecord = <span class="hljs-property">@history</span>[j][key]</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if optionRecord?
if history record is object</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">        <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> optionRecord <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>get the end value and delete the record</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">          valueKeys = Object.keys(optionRecord)
          value = optionRecord[valueKeys[<span class="hljs-number">0</span>]]
          <span class="hljs-keyword">delete</span> <span class="hljs-property">@history</span>[j][key][valueKeys[<span class="hljs-number">0</span>]]</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if delta in history and object in passed value
:: new {100: 50} was {200: 40}</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">          <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> o[key] <span class="hljs-keyword">is</span> <span class="hljs-string">'object'</span>
            valueKeys2 = Object.keys(o[key])
            value2 = o[key][valueKeys2[<span class="hljs-number">0</span>]]
            <span class="hljs-property">@history</span>[j][key][value2] = value</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>:: new 20 was {200: 40}</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">          <span class="hljs-keyword">else</span> <span class="hljs-property">@history</span>[j][key][o[key]] = value
          <span class="hljs-keyword">break</span>
        <span class="hljs-keyword">else</span> <span class="hljs-property">@history</span>[j][key] = o[key]</div></div>
      
      </div>
    
      <div class="segment">
      
      
        <div class="code"><div class="wrapper">  <span class="hljs-attribute">tuneNewOption</span>:<span class="hljs-function"><span class="hljs-params">(o, isForeign)</span>-&gt;</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if type is defined and it&#39;s different
than the current type - warn and delete</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> o? <span class="hljs-keyword">and</span> o.type? <span class="hljs-keyword">and</span> o.type <span class="hljs-keyword">isnt</span> (<span class="hljs-property">@o</span>.type <span class="hljs-keyword">or</span> <span class="hljs-property">@type</span>)
      <span class="hljs-property">@h</span>.warn <span class="hljs-string">'Sorry, type can not be changed on run'</span>
      <span class="hljs-keyword">delete</span> o.type</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>extend defaults only if options obj was passed</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    <span class="hljs-keyword">if</span> o? <span class="hljs-keyword">and</span> Object.keys(o).length
      <span class="hljs-property">@extendDefaults</span>(o); <span class="hljs-property">@resetTimeline</span>()
      !isForeign <span class="hljs-keyword">and</span> <span class="hljs-property">@tween</span>.recalcDuration()
      <span class="hljs-property">@calcSize</span>()
      !isForeign <span class="hljs-keyword">and</span> <span class="hljs-property">@setElStyles</span>()</div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>defer tween start to wait for &quot;then&quot; functions</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">  <span class="hljs-attribute">startTween</span>:<span class="hljs-function">-&gt;</span> setTimeout (<span class="hljs-function">=&gt;</span> <span class="hljs-property">@tween</span>?.start()), <span class="hljs-number">1</span>
  <span class="hljs-attribute">resetTimeline</span>:<span class="hljs-function">-&gt;</span></div></div>
      
      </div>
    
      <div class="segment">
      
        <div class="comments ">
          <div class="wrapper"><p>if you reset the timeline options -
you should reset the whole &quot;then&quot; chain
if one is present</p>
</div>
        </div>
      
      
        <div class="code"><div class="wrapper">    timelineOptions = {}
    <span class="hljs-keyword">for</span> key, i <span class="hljs-keyword">in</span> Object.keys <span class="hljs-property">@h</span>.tweenOptionMap
      timelineOptions[key] = <span class="hljs-property">@props</span>[key]
    timelineOptions.onStart    = <span class="hljs-property">@props</span>.onStart
    timelineOptions.onComplete = <span class="hljs-property">@props</span>.onComplete
    <span class="hljs-property">@timeline</span>.setProp timelineOptions
  
  <span class="hljs-attribute">getBitLength</span>:<span class="hljs-function">-&gt;</span>
    <span class="hljs-property">@props</span>.bitLength = <span class="hljs-property">@bit</span>.getLength()
    <span class="hljs-property">@props</span>.bitLength

<span class="hljs-built_in">module</span>.exports = Transit

</div></div>
      
      </div>
    
    </div>
  </div>

  <script src="../toc.js"></script>
  <script src="../assets/libs.js"></script>
  <script src="../assets/behavior.js"></script>

  
    
      <script>
        function __cp_domReady(e){/in/.test(document.readyState)?setTimeout("__cp_domReady("+e+")",9):e()}document.getElementsByClassName||(document.getElementsByClassName=function(e){var t,n,a,r=document,s=[];if(r.querySelectorAll)return r.querySelectorAll("."+e);if(r.evaluate)for(n=".//*[contains(concat(' ', @class, ' '), ' "+e+" ')]",t=r.evaluate(n,r,null,0,null);a=t.iterateNext();)s.push(a);else for(t=r.getElementsByTagName("*"),n=new RegExp("(^|\\s)"+e+"(\\s|$)"),a=0;a<t.length;a++)n.test(t[a].className)&&s.push(t[a]);return s});var CodePenEmbed={width:"100%",init:function(){return window.__cp_embed_script_ran?0:(window.__cp_embed_script_ran=!0,this.showCodePenEmbeds(),void this.listenToParentPostMessages())},showCodePenEmbeds:function(){for(var e=document.getElementsByClassName("codepen"),t=e.length-1;t>-1;t--){var n=this._getParamsFromAttributes(e[t]);if(n=this._convertOldDataAttributesToNewDataAttributes(n),n.user=this._findUsernameForURL(n,e[t]),this._paramsHasRequiredAttributes(n)){var a=this._buildURL(n),r=this._buildIFrame(n,a);this._addIFrameToPage(e[t],r)}}},_findUsernameForURL:function(e,t){if("string"==typeof e.user)return e.user;for(var n=0,a=t.children.length;a>n;n++){var r=t.children[n],s=r.href||"",i=s.match(/codepen\.(io|dev)\/(\w+)\/pen\//i);if(i)return i[2]}return"anon"},_paramsHasRequiredAttributes:function(e){return e["slug-hash"]},_getParamsFromAttributes:function(e){for(var t={},n=e.attributes,a=0,r=n.length;r>a;a++){var s=n[a].name;0===s.indexOf("data-")&&(t[s.replace("data-","")]=n[a].value)}return t},_convertOldDataAttributesToNewDataAttributes:function(e){return e.href&&(e["slug-hash"]=e.href),e.type&&(e["default-tab"]=e.type),e.safe&&(e.animations="true"===e.safe?"run":"stop-after-5"),e},_buildURL:function(e){var t=this._getHost(e),n=e.user?e.user:"anon",a="?"+this._getGetParams(e),r=[t,n,"embed",e["slug-hash"]+a].join("/");return r.replace(/\/\//g,"//")},_getHost:function(e){return e.host?this._getSafeHost(e.host):"file:"===document.location.protocol?"http://codepen.io":"//codepen.io"},_getSafeHost:function(e){return e.match(/^\/\//)||!e.match(/http:/)?document.location.protocol+"//"+e:e},_getGetParams:function(e){var t="";for(var n in e)""!==t&&(t+="&"),t+=n+"="+encodeURIComponent(e[n]);return t},_buildIFrame:function(e,t){var n="";""!==e["class"]&&(n=e["class"]);var a={id:"cp_embed_"+e["slug-hash"].replace("/","_"),src:t,scrolling:"no",frameborder:"0",height:this._getHeight(e),allowTransparency:"true",allowfullscreen:"true","class":"cp_embed_iframe "+n,style:"width: "+this.width+"; overflow: hidden;"},r="<iframe ";for(var s in a)r+=s+'="'+a[s]+'" ';return r+="></iframe>"},_getHeight:function(e){return e.height?"auto"===e.height?300:e.height:300},_addIFrameToPage:function(e,t){if(e.parentNode){var n=document.createElement("div");n.innerHTML=t,e.parentNode.replaceChild(n,e)}else e.innerHTML=t},listenToParentPostMessages:function(){var eventMethod=window.addEventListener?"addEventListener":"attachEvent",eventListener=window[eventMethod],messageEvent="attachEvent"===eventMethod?"onmessage":"message";eventListener(messageEvent,function(e){try{var dataObj=eval("("+e.data+")"),iframe=document.getElementById("cp_embed_"+dataObj.hash);iframe&&(iframe.height=dataObj.height)}catch(err){}},!1)}};__cp_domReady(function(){CodePenEmbed.init()});
      </script>
    
  
</body>
</html>